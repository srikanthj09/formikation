/*

  Formikation, simple form beautifier
  By VÃ­ctor Ortiz @vorthize

    Collaborators:
    Carlos Cabo @putuko

  V.0.1 (2014/01/20)
  http://github.com

*/formikation={dat:{els:null},defaults:{mapClass:!0,mapStyle:!0},init:function(e){if(typeof document.body.style.maxHeight=="undefined")return this;this.defaults=$.extend(this.defaults,e);this.dat.els.each(function(e){$(this).is(":checkbox, :radio")?formikation.processRadioCheck(this):$(this).is("select")?formikation.processSelects(this):$(this).is("input:file")&&formikation.processInputFile(this)})},processRadioCheck:function(e){var t=$(e),n=t.closest("label");t.is(":checkbox")?n.addClass("fk-check"):n.addClass("fk-radio");t.on("fk_update",function(){if(t.prop("checked")){$(':radio[name="'+t.attr("name")+'"]').closest("label").removeClass("checked");n.addClass("checked")}else n.removeClass("checked")});t.on("click",function(){t.trigger("fk_update")});t.trigger("fk_update")},processSelects:function(e){var t=$(e),n=$("<span />").addClass(this.getClass(t,"-label")),r=$("<span />"),i=t.is("input:file")?"file":"select";t.after(r.append(n));r.addClass(i);this.defaults.mapClass&&r.addClass(t.attr("class"));this.defaults.mapStyle&&r.attr("style",t.attr("style"));t.addClass("hasCustomSelect").on("update",function(){formikation.changed(t,r);formikation.updateSelectWH(t)}).on("change",function(){r.addClass(formikation.getClass(t,"Changed"));formikation.changed(t,r);formikation.updateSelectWH(t)}).on("keyup",function(e){if(!r.hasClass(formikation.getClass(t,"Open"))){t.blur();t.focus()}else(e.which==13||e.which==27)&&formikation.changed(t,r)}).on("mousedown",function(e){r.removeClass(formikation.getClass(t,"Changed"))}).on("mouseup",function(e){if(!r.hasClass(formikation.getClass(t,"Open")))if($("."+formikation.getClass(t,"Open")).not(r).length>0&&typeof InstallTrigger!="undefined")t.focus();else{r.addClass(formikation.getClass(t,"Open"));e.stopPropagation();$(document).one("mouseup."+formikation.getClass(t,"Open"),function(e){e.target!=t.get(0)&&$.inArray(e.target,t.find("*").get())<0?t.blur():formikation.changed(t,r)})}}).focus(function(){r.removeClass(formikation.getClass(t,"Changed")).addClass(formikation.getClass(t,"Focus"))}).blur(function(){r.removeClass(formikation.getClass(t,"Focus")+" "+formikation.getClass(t,"Open"))}).hover(function(){r.addClass(formikation.getClass(t,"Hover"))},function(){r.removeClass(formikation.getClass(t,"Hover"))}).trigger("update")},processInputFile:function(e){},updateSelectWH:function(e){var t=$(e),n=t.next("span");n.css({display:"inline-block"});var r=parseInt(n.outerWidth(),10),i=parseInt(n.outerHeight(),10);t.attr("disabled")?n.addClass(formikation.getClass(t,"Disabled")):n.removeClass(formikation.getClass(t,"Disabled"));t.css({"-webkit-appearance":"menulist-button",width:r,height:i,position:"absolute",opacity:0,fontSize:n.css("font-size")})},getClass:function(e,t){var n=e.is("input:file")?"file":"select";return n+t},changed:function(e,t){var n=e.find(":selected"),r=t.children(":first"),i=n.html()||e.val();r.html(i);n.attr("disabled")?t.addClass(getClass(e,"DisabledOption")):t.removeClass(formikation.getClass(e,"DisabledOption"));setTimeout(function(){t.removeClass(formikation.getClass(e,"Open"));$(document).off("mouseup."+formikation.getClass(e,"Open"))},60)}};(function(e){e.fn.formikation=function(e){formikation.dat.els=this;formikation.init(e)}})(jQuery);